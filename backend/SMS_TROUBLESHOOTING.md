# Диагностика проблем с отправкой SMS через SMSC.kz

## Быстрая проверка

1. **Проверьте настройки в `.env` файле:**
   ```bash
   SMSC_LOGIN=ukudarov
   SMSC_PASSWORD=Raushan1956!
   SMSC_SENDER=UNICOVER
   SMSC_API_URL=https://smsc.kz/sys/send.php
   ```

2. **Протестируйте отправку SMS через команду Django:**
   ```bash
   python manage.py test_sms --phone 77001234567 --message "Тестовое сообщение"
   ```
   Замените `77001234567` на реальный номер телефона для тестирования.

3. **Проверьте логи Django:**
   При отправке SMS все действия логируются. Проверьте логи на наличие ошибок:
   - Ошибки аутентификации
   - Ошибки формата номера телефона
   - Ошибки от SMSC.kz API

## Возможные проблемы и решения

### 1. Сообщение не отправляется, но ошибок нет
**Причина:** SMSC.kz может не возвращать ошибку, но сообщение не доставляется.

**Решение:**
- Проверьте баланс в личном кабинете SMSC.kz
- Убедитесь, что имя отправителя `UNICOVER` зарегистрировано и одобрено
- Проверьте формат номера телефона (должен быть в формате 77001234567)

### 2. Ошибка "SMS service not configured"
**Причина:** Переменные окружения не загружены.

**Решение:**
- Убедитесь, что файл `.env` существует в директории `backend/`
- Перезапустите Django сервер после создания/изменения `.env`
- Проверьте, что `python-dotenv` установлен: `pip install python-dotenv`

### 3. Ошибка "Rate limit exceeded"
**Причина:** Превышен лимит запросов (3 запроса в минуту на номер).

**Решение:**
- Подождите 1 минуту перед повторной попыткой
- Лимит автоматически сбрасывается через 60 секунд

### 4. Ошибка от SMSC.kz API
**Возможные причины:**
- Неверный логин/пароль
- Недостаточно средств на балансе
- Неверный формат номера телефона
- Имя отправителя не зарегистрировано

**Решение:**
- Проверьте учетные данные в личном кабинете SMSC.kz
- Проверьте баланс
- Убедитесь, что имя отправителя одобрено

### 5. Сообщение отправляется, но не доставляется
**Причина:** Проблемы на стороне SMSC.kz или оператора связи.

**Решение:**
- Проверьте статус сообщения в личном кабинете SMSC.kz
- Убедитесь, что номер телефона активен и может принимать SMS
- Проверьте, не заблокирован ли номер для приема SMS

## Отладка

### Включение подробного логирования

В `settings.py` добавьте:
```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'apps.accounts': {
            'handlers': ['console'],
            'level': 'DEBUG',  # Измените на DEBUG для подробных логов
        },
        'apps.protocols': {
            'handlers': ['console'],
            'level': 'DEBUG',
        },
    },
}
```

### Проверка через API endpoint

Вы можете проверить отправку SMS через API:
```bash
POST /api/auth/sms/send/
{
  "phone": "77001234567",
  "purpose": "verification"
}
```

Ответ будет содержать:
- `otp_code` - код в режиме отладки (если SMS не отправилось)
- `sms_sent` - статус отправки SMS
- `sms_error` - ошибка отправки (если есть)

## Контакты поддержки SMSC.kz

Если проблема не решается, обратитесь в поддержку SMSC.kz:
- Сайт: https://smsc.kz
- Email: support@smsc.kz
- Телефон: указан на сайте

